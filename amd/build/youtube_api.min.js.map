{"version":3,"sources":["../src/youtube_api.js"],"names":["define","$","init","args","videos","each","playerid","id","split","videoid","videouniqid","getJsonObjectFromIdAttribut","document","ready","loadPlayer","YT","Player","tag","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","window","onYouTubePlayerAPIReady","index","item","onYouTubePlayer","player","ytparam","uniqeid","videoId","playerVars","events","onPlayerStateChange","catchError","click","state","getPlayerState","PlayerState","PLAYING","pauseVideo","playVideo","event","frameid","target","a","ids","removeAttr","hide","data","getCurrentTime","loadVideoById","startSeconds","endSeconds","show","ENDED","PAUSED","console","log","attribut","uniqid","jsonobj","parseJSON","attr","value","e","buttonid","buttonarr","delay","fadeIn"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller YouTube Videos.\n *\n * @module     filter_mbsyoutube/youtubevideos\n * @package    filter_mbsyoutube\n * @copyright  2019 Peter Mayer, ISB Bayern, peter.mayer@isb.bayern.de\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function ($) {\n\n    return {\n        init: function (args) {\n\n            var videos = {};\n            $('.mbsyoutube-ytiframe').each(function () {\n                var playerid = this.id.split(\"___\");\n                var videoid = playerid[2];\n                var videouniqid = playerid[1];\n                videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', videouniqid);\n            });\n\n            $(document).ready(function () {\n                loadPlayer();\n            });\n\n            /**\n             * Sets the YouTube API to Dome and initiats the players\n             */\n            function loadPlayer() {\n                if (typeof (YT) == 'undefined' || typeof (YT.Player) == 'undefined') {\n\n                    var tag = document.createElement('script');\n                    tag.src = \"https://www.youtube.com/iframe_api\";\n                    var firstScriptTag = document.getElementsByTagName('script')[0];\n                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n                    window.onYouTubePlayerAPIReady = function () {\n                        $.each(videos, function (index, item) {\n                            onYouTubePlayer(item['videoid'], item['ytparam'], index);\n                        });\n                    };\n\n                } else {\n\n                    $.each(videos, function (index, item) {\n                        onYouTubePlayer(item['videoid'], item['ytparam'], index);\n                    });\n\n                }\n            }\n\n            var player = {};\n\n            /**\n             * Initiates one YouTube player\n             * @param string videoid\n             * @param array ytparam\n             */\n            function onYouTubePlayer(videoid, ytparam, uniqeid) {\n                player[uniqeid] = new YT.Player('yt___' + uniqeid + '___' + videoid, {\n                    videoId: videoid,\n                    playerVars: ytparam,\n                    events: {\n                        'onStateChange': onPlayerStateChange,\n                        'onError': catchError\n                    }\n                });\n\n                // Adds eventlistener to transparent layer to start/stop vdideo.\n                $('#yt___baroverlay___' + uniqeid + \"___\" + videoid).click(function () {\n                    var playerid = this.id.split(\"___\");\n                    var videouniqid = playerid[2];\n                    var state = player[videouniqid].getPlayerState();\n                    if (state == YT.PlayerState.PLAYING) {\n                        player[videouniqid].pauseVideo();\n                    } else {\n                        player[videouniqid].playVideo();\n                    }\n                });\n            }\n\n            /**\n             * Callback Player State event listener.\n             * @param object event\n             */\n            function onPlayerStateChange(event) {\n\n                var frameid = event.target.a.id;\n                var ids = frameid.split(\"___\");\n                var videoid = ids[2];\n                var uniqeid = ids[1];\n\n                $('#yt___statwrap___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___restart___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___restart___' + uniqeid + '___' + videoid).hide();\n                $('#yt___baroverlay___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___baroverlay___' + uniqeid + '___' + videoid).hide();\n\n                if (event.data == YT.PlayerState.PLAYING) {\n                    videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', uniqeid);\n                    args = videos[uniqeid]['ytparam'];\n                    if (args['end'] == '' || args['end'] == 0) {\n                        delete args['end'];\n                    }\n                    if (player[uniqeid].getCurrentTime() > args['end'] || player[uniqeid].getCurrentTime() < args['start']) {\n                        player[uniqeid].loadVideoById({\n                            videoId: videoid,\n                            startSeconds: args['start'],\n                            endSeconds: args['end']\n                        });\n                    }\n                    $('#' + frameid).show();\n                } else if (event.data == YT.PlayerState.ENDED) {\n                    $('#yt___play___' + uniqeid + '___' + videoid).hide();\n                    $('#yt___restart___' + uniqeid + '___' + videoid).show();\n                    $('#yt___statwrap___' + uniqeid + '___' + videoid).show();\n                    $('#yt___baroverlay___' + uniqeid + '___' + videoid).hide();\n                    $('#' + frameid).hide();\n                } else if (event.data == YT.PlayerState.PAUSED) {\n                    $('#yt___baroverlay___' + uniqeid + '___' + videoid).show();\n                    $('#yt___restart___' + uniqeid + '___' + videoid).hide();\n                    $('#yt___statwrap___' + uniqeid + '___' + videoid).show();\n                }\n            }\n\n            /**\n             * Catches Errors.\n             * @param object event\n             */\n            function catchError(event) {\n                if (event.data == 100) {\n                    console.log(\"Error - The video is not accessable!\");\n                }\n            }\n\n            /**\n             * Makes a json object from an data-attribut value of a tag.\n             * @param string videoid\n             * @param string attribut\n             */\n            function getJsonObjectFromIdAttribut(videoid, attribut, uniqid) {\n                var jsonobj = $.parseJSON($('#yt___' + uniqid + '___' + videoid).attr(attribut));\n                videos[uniqid] = {};\n                videos[uniqid]['ytparam'] = {};\n                videos[uniqid]['videoid'] = videoid;\n                $.each(jsonobj, function (index, value) {\n                    videos[uniqid]['ytparam'][index] = value;\n                });\n                return videos;\n            }\n\n            // OnClick event for start playing.\n            $(\".mbsyoutube-yt-play\").click(function (e) {\n                var buttonid = e.target.id;\n                var buttonarr = buttonid.split(\"___\");\n                var uniqid = buttonarr[2];\n                var videoid = buttonarr[3];\n                $('#yt___' + uniqid + '___' + videoid).delay(200).fadeIn(400);\n                player[uniqid].playVideo();\n            });\n\n            // OnClick event for restart video after endded.\n            $(\".mbsyoutube-yt-restart\").click(function (e) {\n                var buttonid = e.target.id;\n                var buttonarr = buttonid.split(\"___\");\n                var uniqid = buttonarr[2];\n                var videoid = buttonarr[3];\n                $('#yt___' + uniqid + '___' + videoid).delay(200).fadeIn(400);\n\n                videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', uniqid);\n                args = videos[uniqid]['ytparam'];\n\n                player[uniqid].loadVideoById({\n                    videoId: videoid,\n                    startSeconds: args['start'],\n                    endSeconds: args['end']\n                });\n            });\n        }\n    };\n});"],"file":"youtube_api.min.js"}
{"version":3,"sources":["../src/youtube_api.js"],"names":["define","$","init","args","videos","initPlayer","observer","MutationObserver","length","observe","document","subtree","attributes","each","playerid","id","split","videoid","videouniqid","getJsonObjectFromIdAttribut","ready","loadPlayer","YT","Player","tag","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","window","onYouTubePlayerAPIReady","index","item","onYouTubePlayer","player","ytparam","uniqeid","videoId","playerVars","events","onPlayerStateChange","catchError","click","state","getPlayerState","PlayerState","PLAYING","pauseVideo","playVideo","event","frameid","target","a","ids","removeAttr","hide","data","getCurrentTime","loadVideoById","startSeconds","endSeconds","show","ENDED","PAUSED","console","log","attribut","uniqid","jsonobj","parseJSON","attr","value","e","buttonid","buttonarr","delay","fadeIn"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller YouTube Videos.\n *\n * @module     filter_mbsyoutube/youtubevideos\n * @package    filter_mbsyoutube\n * @copyright  2019 Peter Mayer, ISB Bayern, peter.mayer@isb.bayern.de\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function ($) {\n\n    return {\n        init: function (args) {\n            var videos = {};\n            initPlayer();\n\n            // If there is no yt confirm button. Observe the dome if there will be a change.\n            var observer = new MutationObserver(function () {\n                // Fired when a mutation occurs.\n                if ($('.mbsyoutube-ytiframe').length > 0) {\n                    initPlayer();\n                }\n            });\n\n            // Define what element should be observed by the observer\n            // and what types of mutations trigger the callback\n            observer.observe(document, {\n                subtree: true,\n                attributes: true\n            });\n\n            /**\n             * Initialize the Player.\n             */\n            function initPlayer() {\n                $('.mbsyoutube-ytiframe').each(function () {\n                    var playerid = this.id.split(\"___\");\n                    var videoid = playerid[2];\n                    var videouniqid = playerid[1];\n                    videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', videouniqid);\n                });\n\n                $(document).ready(function () {\n                    loadPlayer();\n                });\n            }\n\n            /**\n             * Sets the YouTube API to Dome and initiats the players\n             */\n            function loadPlayer() {\n                if (typeof (YT) == 'undefined' || typeof (YT.Player) == 'undefined') {\n\n                    var tag = document.createElement('script');\n                    tag.src = \"https://www.youtube.com/iframe_api\";\n                    var firstScriptTag = document.getElementsByTagName('script')[0];\n                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n                    window.onYouTubePlayerAPIReady = function () {\n                        $.each(videos, function (index, item) {\n                            onYouTubePlayer(item['videoid'], item['ytparam'], index);\n                        });\n                    };\n\n                } else {\n\n                    $.each(videos, function (index, item) {\n                        onYouTubePlayer(item['videoid'], item['ytparam'], index);\n                    });\n\n                }\n            }\n\n            var player = {};\n\n            /**\n             * Initiates one YouTube player\n             * @param {string} videoid\n             * @param {*} ytparam\n             * @param {string} uniqeid\n             */\n            function onYouTubePlayer(videoid, ytparam, uniqeid) {\n                player[uniqeid] = new YT.Player('yt___' + uniqeid + '___' + videoid, {\n                    videoId: videoid,\n                    playerVars: ytparam,\n                    events: {\n                        'onStateChange': onPlayerStateChange,\n                        'onError': catchError\n                    }\n                });\n\n                // Adds eventlistener to transparent layer to start/stop vdideo.\n                $('#yt___baroverlay___' + uniqeid + \"___\" + videoid).click(function () {\n                    var playerid = this.id.split(\"___\");\n                    var videouniqid = playerid[2];\n                    var state = player[videouniqid].getPlayerState();\n                    if (state == YT.PlayerState.PLAYING) {\n                        player[videouniqid].pauseVideo();\n                    } else {\n                        player[videouniqid].playVideo();\n                    }\n                });\n            }\n\n            /**\n             * Callback Player State event listener.\n             * @param {object} event\n             */\n            function onPlayerStateChange(event) {\n\n                var frameid = event.target.a.id;\n                var ids = frameid.split(\"___\");\n                var videoid = ids[2];\n                var uniqeid = ids[1];\n\n                $('#yt___statwrap___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___restart___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___restart___' + uniqeid + '___' + videoid).hide();\n                $('#yt___baroverlay___' + uniqeid + '___' + videoid).removeAttr('hidden');\n                $('#yt___baroverlay___' + uniqeid + '___' + videoid).hide();\n\n                if (event.data == YT.PlayerState.PLAYING) {\n                    videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', uniqeid);\n                    args = videos[uniqeid]['ytparam'];\n                    if (args['end'] == '' || args['end'] == 0) {\n                        delete args['end'];\n                    }\n                    if (player[uniqeid].getCurrentTime() > args['end'] || player[uniqeid].getCurrentTime() < args['start']) {\n                        player[uniqeid].loadVideoById({\n                            videoId: videoid,\n                            startSeconds: args['start'],\n                            endSeconds: args['end']\n                        });\n                    }\n                    $('#' + frameid).show();\n                } else if (event.data == YT.PlayerState.ENDED) {\n                    $('#yt___play___' + uniqeid + '___' + videoid).hide();\n                    $('#yt___restart___' + uniqeid + '___' + videoid).show();\n                    $('#yt___statwrap___' + uniqeid + '___' + videoid).show();\n                    $('#yt___baroverlay___' + uniqeid + '___' + videoid).hide();\n                    $('#' + frameid).hide();\n                } else if (event.data == YT.PlayerState.PAUSED) {\n                    $('#yt___baroverlay___' + uniqeid + '___' + videoid).show();\n                    $('#yt___restart___' + uniqeid + '___' + videoid).hide();\n                    $('#yt___statwrap___' + uniqeid + '___' + videoid).show();\n                }\n            }\n\n            /**\n             * Catches Errors.\n             * @param {object} event\n             */\n            function catchError(event) {\n                if (event.data == 100) {\n                    window.console.log(\"Error - The video is not accessable!\");\n                }\n            }\n\n            /**\n             * Makes a json object from an data - attribut value of a tag.\n             * @param {string} videoid\n             * @param {string} attribut\n             * @param {string} uniqid\n             * @returns {array}\n             */\n            function getJsonObjectFromIdAttribut(videoid, attribut, uniqid) {\n                var jsonobj = $.parseJSON($('#yt___' + uniqid + '___' + videoid).attr(attribut));\n                videos[uniqid] = {};\n                videos[uniqid]['ytparam'] = {};\n                videos[uniqid]['videoid'] = videoid;\n                $.each(jsonobj, function (index, value) {\n                    videos[uniqid]['ytparam'][index] = value;\n                });\n                return videos;\n            }\n\n            // OnClick event for start playing.\n            $(\".mbsyoutube-yt-play\").click(function (e) {\n                var buttonid = e.target.id;\n                var buttonarr = buttonid.split(\"___\");\n                var uniqid = buttonarr[2];\n                var videoid = buttonarr[3];\n                $('#yt___' + uniqid + '___' + videoid).delay(200).fadeIn(400);\n                player[uniqid].playVideo();\n            });\n\n            // OnClick event for restart video after endded.\n            $(\".mbsyoutube-yt-restart\").click(function (e) {\n                var buttonid = e.target.id;\n                var buttonarr = buttonid.split(\"___\");\n                var uniqid = buttonarr[2];\n                var videoid = buttonarr[3];\n                $('#yt___' + uniqid + '___' + videoid).delay(200).fadeIn(400);\n\n                videos = getJsonObjectFromIdAttribut(videoid, 'data-extern', uniqid);\n                args = videos[uniqid]['ytparam'];\n\n                player[uniqid].loadVideoById({\n                    videoId: videoid,\n                    startSeconds: args['start'],\n                    endSeconds: args['end']\n                });\n            });\n        }\n    };\n});"],"file":"youtube_api.min.js"}